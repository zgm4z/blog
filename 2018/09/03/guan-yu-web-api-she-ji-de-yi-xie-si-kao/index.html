<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  
  
  
    <meta name="description" content="善读书可以治愚。">
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>
    关于 WEB API 设计的一些思考 |
    
    Z</title>
  
    <link rel="shortcut icon" href="/favicon.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<script src="/js/pace.min.js"></script>

<meta name="generator" content="Hexo 5.2.0"></head>

<body>
<main class="content">
  <section class="outer">
  <article id="post-guan-yu-web-api-she-ji-de-yi-xie-si-kao" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

    <div class="article-inner">
        
            <header class="article-header">
                
  
    <h1 class="article-title" itemprop="name">
      关于 WEB API 设计的一些思考
    </h1>
  
  




            </header>
            

                
                    <div class="article-meta">
                        <a href="/2018/09/03/guan-yu-web-api-she-ji-de-yi-xie-si-kao/" class="article-date">
  <time datetime="2018-09-03T11:17:15.000Z" itemprop="datePublished">2018-09-03</time>
</a>
                            
                    </div>
                    

                        
                            
    <div class="tocbot"></div>





                                

                                    <div class="article-entry" itemprop="articleBody">
                                        


                                            

                                                
                                                                    <p>临近开学，有些懈怠了，并没有动力写新文章，自上次发布新文章已经过了好几天，其实也是在思考要写一篇什么样的文章，这些天也查阅了一些文章，这次打算发布一篇不那么关注具体技术实现的文章，基于以前自己关于网站对外提供数据服务 API 的思考和一些前辈写的博文，我们就来聊一聊关于一种流行的API设计风格 - RESTful API，我不敢说自己对这种设计风格有很深的理解，本文也不具有任何权威性，请科学的对待任何不是标准的东西，借鉴和怀疑，切勿照搬。</p>
<a id="more"></a>

<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>在博主早期的 web 开发经验中，对于需要提供对外数据服务，或者是有多端用户时( browser，APP ) 对于此种需求只是简单使用 HTTP GET / POST 来请求数据，用 URL 来描诉操作和操作的资源，通常会得出如下接口:</p>
<blockquote>
<p> POST api.example.com/createUser 创建一个用</p>
<p> GET  api.example.com/createUser?username=a&amp;age=12 创建一个用户</p>
</blockquote>
<blockquote>
<p>GET  api.example.com/findUserById?userId=1 获取特定 id 的用户</p>
<p>POST api.example.com/findUserById?userId=1 获取特定 id 的用户</p>
</blockquote>
<p>这样设计的 API 大多数时候并不关心客户端使用的是那种 HTTP method 因为它是根据 URL 来确定操作，实际上也只是 API 消费端根据 URL 猜测接口的操作，如果没有明确的 API 文档来指出此接口执行何种操作，将是难以理解的，而你总是很难找到愿意仔仔细细写文档的程序员 : ) ，而且参数的传递同时可通过 request body 或者 query string，这就造成一种不统一，这样的设计使用体验很差，表意不明，不具有自描诉性，如何设计更好的 API 更易于使用的 API 对消费端友好的 API，这些问题困扰着博主，因为博主那时候还是个萌新，也没有很丰富的开发经验，一直思考了很久，也没有很好的答案，在展开讲新的设计风格之前先来讨论一下其他与 API 设计密切相关的东西。</p>
<h1 id="Resource"><a href="#Resource" class="headerlink" title="Resource"></a>Resource</h1><p>我们知道一定是因为有其他的消费端希望能够使用或者消费我们保存在服务器上的数据和服务，所以才需要我们提供一个友好的方式让其通过指定的接口和后端服务进行交互，使用或者消费的东西我们把它称为 <strong>Resource</strong>，即 “资源”，所谓资源就是存在服务器一些数据或一个服务，对于 Resource 定义不是局限于某一特定的东西，资源可以是一个 html 文件，一个 js 脚本文件，一张图片，一个视频，一个可以查询天气情况的服务，可以是任何东西，我们这里讨论 API design 说的的是基于 HTTP 协议构建的 WEB API ，关于资源的描诉在 <a target="_blank" rel="noopener" href="https://www.rfc-editor.org/info/rfc7231">RFC7231</a> 中是这样说的:</p>
<blockquote>
<p>The target of an HTTP request is called a “resource”.  HTTP does not limit the nature of a resource; it merely defines an interface that might be used to interact with resources.</p>
</blockquote>
<h1 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h1><p>前面说设计开放 API  的目的就是为了提供一种方式使得在服务器上的资源能被其他使用者使用，由于资源都是保存在一个网络主机中，同在一个互联网内的任何人都能在被允许的情况下获取主机上的资源，这样我们就需要有一个绝对的资源地址来标记一个存在的资源，并通过地址对资源操作，这就像我们自己的家庭地址一样，在地球上是一个唯一绝对的地址，在基于网络的架构中我们把用于定位资源的地址称为 <strong>统一资源定位符（URL）</strong>，英文是 <strong>Uniform Resource Locator</strong>，通过这样一个协议来表示网络上的资源地址，这就是我们常说的 “网址”，”网页地址”，经过 W3C 工作组制定的规范文件位于 <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc1738">RFC1738</a>，一个标准的资源地址用 URL 可以简单的表示为: <strong>协议类型+主机地址+端口号+资源路径+资源名</strong>，如一个网页文档的地址: <a target="_blank" rel="noopener" href="http://api.example.com/resources/index.html%EF%BC%8C%E8%A1%A8%E7%A4%BA%E4%B8%80%E4%B8%AA%E7%BD%91%E9%A1%B5%E6%96%87%E4%BB%B6%E5%9C%A8%E4%B8%80%E4%B8%AA%E5%90%8D%E4%B8%BA">http://api.example.com:80/resources/index.html，表示一个网页文件在一个名为</a> api.example.com 的网络主机上且资源路径在 /resources 下的 index.html 文件。</p>
<h1 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h1><p>在经过前面两个章节的讨论后，现在可以明确的得出两个关于 API 设计的抽象概念，即：<strong>资源</strong> 和 <strong>资源地址的表示方法</strong>，即使如此，还是不能构建一个可以确保通信双方都能互相理解各自意图并作出应答的环境，还需要有一个协议来明确通信过程中的各种意图的表达和消息的传递，因此引入 Hypertext Transfer Protocol ( HTTP )，即超文本传输协议，参与通信的双方以协议中约定的格式进行交互，操作资源，HTTP 定义了服务器和客户端的交互方式，消息格式，资源操作的各种约定，下面之展开讲请求方法的内容。</p>
<h2 id="Request-Methods-在资源操作上的语义"><a href="#Request-Methods-在资源操作上的语义" class="headerlink" title="Request Methods 在资源操作上的语义"></a>Request Methods 在资源操作上的语义</h2><p>每一个由客户端发起的 http 请求都必须包含一个指明 request method 值的字段用来表明期望服务器对资源执行何种操作，通常，我们使用有限的几个请求方法把其映射到对资源的操作上，如下表所示，使用四个请求方法即可映射到资源的 增删改查 四个基本操作上。</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>GET</td>
<td>请求获取服务器上的一个资源</td>
</tr>
<tr>
<td>POST</td>
<td>在服务器上创建并保存一个资源</td>
</tr>
<tr>
<td>PUT</td>
<td>更新一个服务器资源，客户端必须提供资源的所有属性</td>
</tr>
<tr>
<td>PATCH</td>
<td>更新一个资源，客户端仅提供资源变化的属性</td>
</tr>
<tr>
<td>DELETE</td>
<td>删除服务器上的资源</td>
</tr>
</tbody></table>
<h2 id="HTTP-关于请求的资源状态的响应约定"><a href="#HTTP-关于请求的资源状态的响应约定" class="headerlink" title="HTTP 关于请求的资源状态的响应约定"></a>HTTP 关于请求的资源状态的响应约定</h2><p>在操作资源的过程中并不是一扇风顺的得以完成操作，也有可能发生不可意料的错误，例如我们请求获取一个不存在的资源，或者更新一个不存在的资源属性，或者服务器处理超时，不允许对该资源进行的操作等等，这就需要有一个错误类型及相应给客户端的机制，在 HTTP 中此类机制叫做 response code，服务器的响应消息中会包含一个数字的值和一个简短的状态描述文字，常用的一些状态码又如下几个：</p>
<table>
<thead>
<tr>
<th>code</th>
<th>description</th>
</tr>
</thead>
<tbody><tr>
<td>200</td>
<td>服务器成功接收请求并返回请求的资源</td>
</tr>
<tr>
<td>201</td>
<td>服务器创建或修改资源并保存成功</td>
</tr>
<tr>
<td>204</td>
<td>删除资源成功</td>
</tr>
<tr>
<td>400</td>
<td>请求错误，服务器没有对资源执行任何操作</td>
</tr>
<tr>
<td>401</td>
<td>未授权的操作，表示客户端没有相应的权限执行此操作</td>
</tr>
<tr>
<td>404</td>
<td>表示请求操作的资源不存在</td>
</tr>
<tr>
<td>500</td>
<td>服务器内部发生错误，客户端无法判断是否操作成功</td>
</tr>
</tbody></table>
<h1 id="新的-API-设计风格"><a href="#新的-API-设计风格" class="headerlink" title="新的 API 设计风格"></a>新的 API 设计风格</h1><p>经过上面的讨论，我们可以利用现有的定义和规范来设计一种新的 API 风格，一种自描述，语义明确的 API，简单说就是 URL 只定位资源不表明操作，API 对资源操作由 HTTP 请求方法动词来指代，则可以得出以下形式的接口，假设我们要对动物园的动物进行管理：</p>
<table>
<thead>
<tr>
<th>resource</th>
<th>http method</th>
<th>url</th>
<th>operator</th>
</tr>
</thead>
<tbody><tr>
<td>全体动物</td>
<td>GET</td>
<td>api.example.com/animals</td>
<td>获取所有的动物列表</td>
</tr>
<tr>
<td>狮子</td>
<td>GET</td>
<td>api.example.com/animals/lions</td>
<td>获取所有的狮子列表</td>
</tr>
<tr>
<td>狮子</td>
<td>POST</td>
<td>api.example.com/animals/lions</td>
<td>新建并保存一个新的狮子，属性参数在 request body 指定</td>
</tr>
<tr>
<td>狮子</td>
<td>GET</td>
<td>api.example.com/animals/lions/1</td>
<td>获取指定的id为 1的狮子</td>
</tr>
<tr>
<td>狮子</td>
<td>DELETE</td>
<td>api.example.com/animals/lions/1</td>
<td>删除指定的狮子</td>
</tr>
<tr>
<td>狮子</td>
<td>PUT</td>
<td>api.example.com/animals/lions/1</td>
<td>更新指定的狮子属性，参数在request body设置，必须提供所有属性，即使不变化的属性</td>
</tr>
</tbody></table>
<p>以上操作结果均由 http response code 来确认最终的结果，然后响应信息可以附加在 response body 中。比如在 api.example.com/animals/lions/1 这个接口使用 GET 请求如果不存在 id 为 1 的资源则需要返回 404 状态码，如果存在且有权限读取返回 200，在 response body 写入资源并返回给客户端。</p>
<h1 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h1><p><strong>这篇文章很粗糙,这篇文章很粗糙，因为博主开学了:( 数学好难，不敢挂科，不知道以后还有没有精力写新文章吧，想要查阅更详细的信息请看下面的参考链接</strong></p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p>URL : <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc1738">RFC1738</a></p>
<p>REST :  <a target="_blank" rel="noopener" href="https://github.com/aisuhua/restful-api-design-references/blob/master/%E6%9E%B6%E6%9E%84%E9%A3%8E%E6%A0%BC%E4%B8%8E%E5%9F%BA%E4%BA%8E%E7%BD%91%E7%BB%9C%E7%9A%84%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1.pdf">架构风格与基于网络的软件架构设计</a></p>
<p>HTTP/1.1 Semantics and Content :  <a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc7231.txt">RFC7231</a></p>
<p>GitHub repo : <a target="_blank" rel="noopener" href="https://github.com/aisuhua/restful-api-design-references">restful-api-design-references</a></p>
<p>Wiki : <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E8%A1%A8%E7%8E%B0%E5%B1%82%E7%8A%B6%E6%80%81%E8%BD%AC%E6%8D%A2">表现层状态转移</a></p>
<p>​    </p>

                                                                        
                                    </div>
                                    <footer class="article-footer">
                                        <a data-url="http://example.com/2018/09/03/guan-yu-web-api-she-ji-de-yi-xie-si-kao/" data-id="ckf9ei7g5000qdq6l5eew3esa" class="article-share-link">
                                            分享
                                        </a>
                                        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/API-design/" rel="tag">API design</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/RESTful-API/" rel="tag">RESTful API</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/software-architecture/" rel="tag">software architecture</a></li></ul>

                                    </footer>

    </div>

    
        
  <nav class="article-nav">
    
      <a href="/2019/03/02/ji-zhu-lei-rss-yuan-fen-xiang/" class="article-nav-link">
        <strong class="article-nav-caption">前一篇</strong>
        <div class="article-nav-title">
          
            技术类 RSS 源分享
          
        </div>
      </a>
    
    
      <a href="/2018/08/27/asynchronous-javascript-and-xml-ajax-xiang-jie/" class="article-nav-link">
        <strong class="article-nav-caption">后一篇</strong>
        <div class="article-nav-title">Asynchronous JavaScript and XML (AJAX) 详解</div>
      </a>
    
  </nav>


            

                
                    
                        
                            

</article>
</section>
  <footer class="footer">
  <div class="outer">
    <div class="float-right">
      <ul class="list-inline">
  
    <li><i class="fe fe-smile-alt"></i> <span id="busuanzi_value_site_uv"></span></li>
  
    <li><i class="fe fe-bookmark"></i> <span id="busuanzi_value_page_pv"></span></li>
  
</ul>
    </div>
    <ul class="list-inline">
      <li>&copy; 2020 Z</li>
      <li>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></li>
      <li>Theme  <a target="_blank" rel="noopener" href="https://github.com/zhwangart/hexo-theme-ocean">Ocean</a></li>
    </ul>
  </div>
</footer>

</main>
<aside class="sidebar">
  <button class="navbar-toggle"></button>
<nav class="navbar">
  
    <div class="logo">
      <a href="/"><img src="/images/hexo.svg" alt="Z"></a>
    </div>
  
  <ul class="nav nav-main">
    
      <li class="nav-item">
        <a class="nav-item-link" href="/">Home</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/archives">Archives</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/about">About</a>
      </li>
    
    <li class="nav-item">
      <a class="nav-item-link nav-item-search" title="搜索">
        <i class="fe fe-search"></i>
        搜索
      </a>
    </li>
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      <div class="totop" id="totop">
  <i class="fe fe-rocket"></i>
</div>
    </li>
    <li class="nav-item">
      
        <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
          <i class="fe fe-feed"></i>
        </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
</aside>

<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/jquery.justifiedGallery.min.js"></script>


<script src="/js/lazyload.min.js"></script>


<script src="/js/busuanzi-2.3.pure.min.js"></script>


  
<script src="/fancybox/jquery.fancybox.min.js"></script>




  
<script src="/js/tocbot.min.js"></script>

  <script>
    // Tocbot_v4.7.0  http://tscanlin.github.io/tocbot/
    tocbot.init({
      tocSelector: '.tocbot',
      contentSelector: '.article-entry',
      headingSelector: 'h1, h2, h3, h4, h5, h6',
      hasInnerContainers: true,
      scrollSmooth: true,
      positionFixedSelector: '.tocbot',
      positionFixedClass: 'is-position-fixed',
      fixedSidebarOffset: 'auto',
    });
  </script>



<script src="/js/ocean.js"></script>


</body>
</html>